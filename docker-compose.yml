# ===========================================
# Docker Compose para SIDEPP-Digital
# Versión: Producción (servidor VPS)
# ===========================================
#
# Uso:
#   docker compose up -d --build
#
# La base de datos PostgreSQL debe estar corriendo
# externamente (no incluida en este compose).
# ===========================================

name: sidepp-digital

volumes:
  uploads:
  data-uploads:
  data-extractions:

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: prod
    container_name: sidepp_app
    environment:
      NODE_ENV: production
      PORT: 3000
      HOST: 0.0.0.0
      ORIGIN: ${ORIGIN:-http://vps-5478319-x.dattaweb.com:3000}
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET}
      FILE_STORAGE_DIR: ${FILE_STORAGE_DIR:-/data}
      UPLOAD_DIR: ${UPLOAD_DIR:-/uploads}
      EXTRACTION_DIR: ${EXTRACTION_DIR:-/data/extractions}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      CORS_ORIGIN: ${CORS_ORIGIN:-http://vps-5478319-x.dattaweb.com:3000}
      COOKIE_SECURE: ${COOKIE_SECURE:-false}
    ports:
      - "3000:3000"
    volumes:
      - uploads:/uploads
      - data-uploads:/data/uploads
      - data-extractions:/data/extractions
    restart: unless-stopped
